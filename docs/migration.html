<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeeMarshall - Data Migration Tool</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    
    <style>
        /* Hive Aesthetic - Light Yellow, Dark Yellow, White, Black */
        :root {
            --light-yellow: #FFFACD;
            --dark-yellow: #DAA520;
            --white: #FFFFFF;
            --black: #000000;
            --accent: #FFD700;
            --shadow: 0 8px 32px rgba(218, 165, 32, 0.15);
            --radius: 12px;
            --transition: all .22s cubic-bezier(.4,0,.2,1);
        }
        
        body {
            background: var(--light-yellow);
            font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
            color: var(--black);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .navbar {
            background: linear-gradient(180deg, var(--white), var(--light-yellow));
            border-bottom: 2px solid var(--dark-yellow);
            box-shadow: var(--shadow);
        }
        
        .navbar-brand {
            font-weight: 700;
            color: var(--black) !important;
            font-size: 1.5rem;
        }
        
        .migration-card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 2px solid var(--dark-yellow);
            transition: var(--transition);
        }
        
        .migration-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(218, 165, 32, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--dark-yellow), var(--accent));
            color: var(--black);
            border: 2px solid var(--dark-yellow);
            font-weight: 600;
            transition: var(--transition);
        }
        
        .btn-primary:hover {
            transform: translateY(-1px) scale(1.02);
            box-shadow: 0 12px 28px rgba(218, 165, 32, 0.25);
            background: linear-gradient(135deg, var(--accent), var(--dark-yellow));
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--accent), var(--dark-yellow));
            color: var(--black);
            border: 2px solid var(--accent);
            font-weight: 600;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #90EE90, #32CD32);
            color: var(--black);
            border: 2px solid #32CD32;
            font-weight: 600;
        }
        
        .status-card {
            background: var(--light-yellow);
            border: 2px solid var(--dark-yellow);
            border-radius: var(--radius);
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, var(--dark-yellow), var(--accent));
        }
        
        .text-warning {
            color: var(--dark-yellow) !important;
        }
        
        .text-success {
            color: #32CD32 !important;
        }
        
        .text-danger {
            color: #DC3545 !important;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="beemarshall-full.html">
                <i class="bi bi-shield-fill"></i> BeeMarshall - Migration Tool
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="migration-card p-4">
                    <div class="text-center mb-4">
                        <i class="bi bi-arrow-repeat text-warning" style="font-size: 3rem;"></i>
                        <h1 class="h3 mb-2">Data Migration Tool</h1>
                        <p class="text-muted">Migrate Lars' data to the new tenant structure</p>
                    </div>
                    
                    <!-- Migration Status -->
                    <div class="status-card">
                        <h5><i class="bi bi-info-circle"></i> Migration Status</h5>
                        <div id="migrationStatus">
                            <p class="mb-2">Ready to migrate Lars' data to new tenant structure</p>
                            <div class="progress mb-3" style="height: 8px;">
                                <div class="progress-bar" role="progressbar" style="width: 0%" id="migrationProgress"></div>
                            </div>
                            <div id="migrationLog"></div>
                        </div>
                    </div>
                    
                    <!-- Migration Controls -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="d-grid">
                                <button class="btn btn-primary btn-lg" onclick="startMigration()" id="startButton">
                                    <i class="bi bi-play-circle"></i> Start Migration
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-grid">
                                <button class="btn btn-warning btn-lg" onclick="checkDataStatus()" id="checkButton">
                                    <i class="bi bi-search"></i> Check Data Status
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Preview -->
                    <div class="mt-4">
                        <h5><i class="bi bi-eye"></i> Data Preview</h5>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="text-center p-3 border rounded">
                                    <h4 class="text-warning" id="clustersCount">0</h4>
                                    <small>Clusters</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center p-3 border rounded">
                                    <h4 class="text-warning" id="actionsCount">0</h4>
                                    <small>Actions</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center p-3 border rounded">
                                    <h4 class="text-warning" id="tasksCount">0</h4>
                                    <small>Tasks</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center p-3 border rounded">
                                    <h4 class="text-warning" id="employeesCount">0</h4>
                                    <small>Employees</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Instructions -->
                    <div class="mt-4">
                        <h5><i class="bi bi-list-check"></i> Instructions</h5>
                        <ol>
                            <li>Click "Check Data Status" to see current data structure</li>
                            <li>Click "Start Migration" to begin the migration process</li>
                            <li>Wait for the migration to complete</li>
                            <li>Return to the main application to verify your data</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyALV0NmXT2VIZBrAR6D7rSnphNljhFIeb0",
            authDomain: "beemarshall-378aa.firebaseapp.com",
            databaseURL: "https://beemarshall-378aa-default-rtdb.firebaseio.com",
            projectId: "beemarshall-378aa",
            storageBucket: "beemarshall-378aa.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        let migrationInProgress = false;
        
        // Check data status
        function checkDataStatus() {
            console.log('🔍 Checking data status...');
            updateLog('Checking data status...', 'info');
            
            // Check old data structure
            database.ref('clusters').once('value', (snapshot) => {
                const clusters = snapshot.val();
                document.getElementById('clustersCount').textContent = clusters ? Object.keys(clusters).length : 0;
                updateLog(`Found ${clusters ? Object.keys(clusters).length : 0} clusters in old structure`, 'info');
            });
            
            database.ref('actions').once('value', (snapshot) => {
                const actions = snapshot.val();
                document.getElementById('actionsCount').textContent = actions ? Object.keys(actions).length : 0;
                updateLog(`Found ${actions ? Object.keys(actions).length : 0} actions in old structure`, 'info');
            });
            
            database.ref('scheduledTasks').once('value', (snapshot) => {
                const tasks = snapshot.val();
                document.getElementById('tasksCount').textContent = tasks ? Object.keys(tasks).length : 0;
                updateLog(`Found ${tasks ? Object.keys(tasks).length : 0} scheduled tasks in old structure`, 'info');
            });
            
            database.ref('employees').once('value', (snapshot) => {
                const employees = snapshot.val();
                document.getElementById('employeesCount').textContent = employees ? Object.keys(employees).length : 0;
                updateLog(`Found ${employees ? Object.keys(employees).length : 0} employees in old structure`, 'info');
            });
            
            // Check new structure
            setTimeout(() => {
                database.ref('tenants/lars/clusters').once('value', (snapshot) => {
                    const newClusters = snapshot.val();
                    updateLog(`Found ${newClusters ? Object.keys(newClusters).length : 0} clusters in new structure`, 'success');
                });
            }, 1000);
        }
        
        // Start migration
        function startMigration() {
            if (migrationInProgress) {
                updateLog('Migration already in progress...', 'warning');
                return;
            }
            
            migrationInProgress = true;
            updateLog('Starting migration process...', 'info');
            
            const startButton = document.getElementById('startButton');
            startButton.disabled = true;
            startButton.innerHTML = '<i class="bi bi-arrow-clockwise"></i> Migrating...';
            
            let migrationSteps = 0;
            const totalSteps = 5;
            
            // Update progress
            function updateProgress(step) {
                migrationSteps = step;
                const progress = (migrationSteps / totalSteps) * 100;
                document.getElementById('migrationProgress').style.width = progress + '%';
            }
            
            // Migrate clusters
            database.ref('clusters').once('value', (snapshot) => {
                const clusters = snapshot.val();
                if (clusters) {
                    updateLog('Migrating clusters...', 'info');
                    return database.ref('tenants/lars/clusters').set(clusters);
                }
            }).then(() => {
                updateLog('✅ Clusters migrated successfully', 'success');
                updateProgress(1);
                
                // Migrate actions
                return database.ref('actions').once('value', (snapshot) => {
                    const actions = snapshot.val();
                    if (actions) {
                        updateLog('Migrating actions...', 'info');
                        return database.ref('tenants/lars/actions').set(actions);
                    }
                });
            }).then(() => {
                updateLog('✅ Actions migrated successfully', 'success');
                updateProgress(2);
                
                // Migrate scheduled tasks
                return database.ref('scheduledTasks').once('value', (snapshot) => {
                    const tasks = snapshot.val();
                    if (tasks) {
                        updateLog('Migrating scheduled tasks...', 'info');
                        return database.ref('tenants/lars/scheduledTasks').set(tasks);
                    }
                });
            }).then(() => {
                updateLog('✅ Scheduled tasks migrated successfully', 'success');
                updateProgress(3);
                
                // Migrate employees
                return database.ref('employees').once('value', (snapshot) => {
                    const employees = snapshot.val();
                    if (employees) {
                        updateLog('Migrating employees...', 'info');
                        return database.ref('tenants/lars/employees').set(employees);
                    }
                });
            }).then(() => {
                updateLog('✅ Employees migrated successfully', 'success');
                updateProgress(4);
                
                // Migrate hives
                return database.ref('hives').once('value', (snapshot) => {
                    const hives = snapshot.val();
                    if (hives) {
                        updateLog('Migrating hives...', 'info');
                        return database.ref('tenants/lars/hives').set(hives);
                    }
                });
            }).then(() => {
                updateLog('✅ Hives migrated successfully', 'success');
                updateProgress(5);
                
                // Migration complete
                updateLog('🎉 Migration completed successfully!', 'success');
                updateLog('You can now return to the main application', 'info');
                
                startButton.innerHTML = '<i class="bi bi-check-circle"></i> Migration Complete';
                startButton.classList.remove('btn-primary');
                startButton.classList.add('btn-success');
                startButton.disabled = false;
                
                migrationInProgress = false;
                
            }).catch(error => {
                updateLog('❌ Migration failed: ' + error.message, 'danger');
                startButton.innerHTML = '<i class="bi bi-exclamation-triangle"></i> Migration Failed';
                startButton.classList.remove('btn-primary');
                startButton.classList.add('btn-danger');
                startButton.disabled = false;
                migrationInProgress = false;
            });
        }
        
        // Update log
        function updateLog(message, type) {
            const log = document.getElementById('migrationLog');
            const timestamp = new Date().toLocaleTimeString();
            const alertClass = type === 'info' ? 'alert-info' : 
                              type === 'success' ? 'alert-success' : 
                              type === 'warning' ? 'alert-warning' : 'alert-danger';
            
            log.innerHTML += `<div class="alert ${alertClass} alert-sm mb-1">
                <small>[${timestamp}] ${message}</small>
            </div>`;
            
            // Scroll to bottom
            log.scrollTop = log.scrollHeight;
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateLog('Migration tool ready', 'info');
            checkDataStatus();
        });
    </script>
</body>
</html>
